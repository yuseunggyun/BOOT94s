<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">

  <!-- 웹 페이지 이름 삽입 -->
  <title>경상남도 진주시 토지적성평가 플랫폼</title>

  <!-- ol 스타일 가져오기 -->
  <link rel="stylesheet" href="node_modules/ol/ol.css">

  <!-- 구글 링크 붙여넣기 -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&display=swap" rel="stylesheet">

  <!-- 최신버전의 JQUERY 불러오기 -->
  <script src="http://code.jquery.com/jquery-latest.min.js"></script>

  <!--검색창 이미지-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  <!--거리 계산 아이콘-->
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">

  <!--면적 계산 아이콘-->
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0">
</head>

<body>
  <!-- OL의 모든 기능 사용 -->
  <script src="https://cdn.jsdelivr.net/npm/ol@latest/dist/ol.js"></script>

  <div class="container">
    <!-- area 영역(좌1 사이드) -->
    <div class="area">
      <!-- 진주 로고 -->
      <div id="header">
        <div id="lxLogo" onClick="window.location.reload()" style="cursor: pointer;"></div>
        <div id="jinjuLogo" onClick="window.location.reload()" style="cursor: pointer;"></div>

        <!-- 동적인 검색창 -->
        <div class="container1">
          <div class="icon">
            <i class="search fa fa-search"></i>
          </div>
          <div class="input_search">
            <input type="text" placeholder="주소입력" id="search">
            <i class="clear fa fa-times"></i>
          </div>
        </div>

        <div id="search-results"></div>

        <!-- 행정구역 리스트 -->
        <div class="ymname">
          <h3 id="ymname1"> 행정 구역명</h3>
          <table class="ymList">
            <tr>
              <td style="width: 50%;"><span id="ym01">문산읍</span></td>
              <td colspan="2"><span id="ym02">내동면</span></td>
            </tr>
            <tr>
              <td style="width: 50%;"><span id="ym03">정촌면</span></td>
              <td colspan="2"><span id="ym04">금곡면</span></td>
            </tr>
            <tr>
              <td style="width: 50%;"><span id="ym05">진성면</span></td>
              <td colspan="2"><span id="ym06">일반성면</span></td>
            </tr>
            <tr>
              <td style="width: 50%;"><span id="ym07">이반성면</span></td>
              <td colspan="2"><span id="ym08">사봉면</span></td>
            </tr>
            <tr>
              <td style="width: 50%;"><span id="ym09">지수면</span></td>
              <td colspan="2"><span id="ym10">대곡면</span></td>
            </tr>
            <tr>
              <td style="width: 50%;"><span id="ym11">금산면</span></td>
              <td colspan="2"><span id="ym12">집현면</span></td>
            </tr>
            <tr>
              <td style="width: 50%;"><span id="ym13">미천면</span></td>
              <td colspan="2"><span id="ym14">명석면</span></td>
            </tr>
            <tr>
              <td style="width:50%"><span id="ym15">대평면</span></td>
              <td colspan="2"><span id="ym16">수곡면</span></td>
            </tr>
            <tr>
              <td><span id="ym17">진주시가</span></td>
              <td id="information">
                <p id="detailInfo" style="cursor: pointer;">상세정보</p>
              </td>
              <td id="information1">
                <p id="detailInfo1" style="cursor: pointer;">평가지표</p>
              </td>
            </tr>
          </table>
          <table class="ymList2">
            <tr>
              <td><span id="dong1">귀곡동&middot;판문동</span></td>
            </tr>
            <tr>
              <td><span id="dong2">이현동&middot;유곡동&middot;상봉동</span></td>
            </tr>
            <tr>
              <td><span id="dong3">하촌동&middot;장재동&middot;봉래동</span></td>
            </tr>
            <tr>
              <td><span id="dong4">평거동&middot;신안동</span></td>
            </tr>
            <tr>
              <td><span id="dong5">봉곡동&middot;인사동&middot;주약동</span></td>
            </tr>
            <tr>
              <td><span id="dong6">계동&middot;중안동&middot;본성동</span></td>
            </tr>
            <tr>
              <td><span id="dong7">평안동&middot;대안동&middot;동성동</span></td>
            </tr>
            <tr>
              <td><span id="dong8">수정동&middot;장대동&middot;옥봉동</span></td>
            </tr>
            <tr>
              <td><span id="dong9">초전동&middot;하대동</span></td>
            </tr>
            <tr>
              <td><span id="dong10">망경동&middot;강남동&middot;칠암동</span></td>
            </tr>
            <tr>
              <td><span id="dong11">상대동&middot;상평동</span></td>
            </tr>
            <tr>
              <td><span id="dong12">남성동&middot;가좌동</span></td>
            </tr>
            <tr>
              <td><span id="dong13">호탄동&middot;충무공동</span></td>
            </tr>
          </table>
        </div> <!-- ymname 닫힘 -->
      </div> <!-- header 닫힘 -->
    </div> <!-- area 닫힘 -->

    <!-- area1 영역 (좌2 사이드) -->
    <div class="area1">
      <div class="sidebar">
        <br><br><br><br><br><br><br>
        <ul class="sideinfo">
          <h2 class="insidebar"> 필지 정보 </h2>
          <div class="landinfo">
            PNU : <div style="display: inline-block;" id="pnu"></div><br>
            소재지 : <div style="display: inline-block;" id="do"></div><br>
            대장구분 : <div style="display: inline-block;" id="cada"></div><br>
            지번 : <div style="display: inline-block;" id="jibun"></div><br>
            지목 : <div style="display: inline-block;" id="jimok"></div><br>
            면적(㎡) : <div style="display: inline-block;" id="are"></div><br>
            공시지가(원) : <div style="display: inline-block;" id="price"></div><br>
            소유구분 : <div style="display: inline-block;" id="owner"></div><br>
            소유권변동사유 : <div style="display: inline-block;" id="owner_re"></div><br>
            소유권변동일자 : <div style="display: inline-block;" id="owner_da"></div><br>
          </div>
        </ul>
      </div>
    </div>
    <br><br><br><br><br><br><br>
    <!-- area3 영역 (우측 사이드) 평가지표 -->
    <div class="area3">
      <div class="sidebar1">
        <ul class="sideinfo1">
          <h2 class="insidebar"> 평가 지표 </h2>
        </ul>
          <div id="score">
            <a href="" id="jinju_link" target="_blank">
              <h3 id="info-title"></h3>
            </a>
            <script src="http://code.jquery.com/jquery-latest.min.js"></script>
            <form id="inputForm">
              <table border="1" class="maindevelop" style="width: 100%;">
                <tr>
                  <th colspan="4" class="develop">개발적성 <button type="submit" class="developbutton">종합점수</button></th>
                </tr>
                <tr>
                  <th rowspan="5" class="indicator" style="writing-mode: vertical-lr; text-align: center; ">필수지표</th>
                </tr>
                <tr>
                  <td><label for="sub1">경사도 :</label></td>
                  <td><input type="number" id="sub1" name="sub1" min="0" max="100" style="width:50px"
                      oninput="validateInput(this)"></td>
                </tr>
                <tr>
                  <td><label for="sub2">표고 :</label></td>
                  <td><input type="number" id="sub2" name="sub2" min="0" max="100" style="width:50px"
                      oninput="validateInput(this)"></td>
                </tr>
                <tr>
                  <td><label for="sub3">기개발지와의 거리 :</label></td>
                  <td><input type="number" id="sub3" name="sub3" min="0" max="100" style="width:50px"
                      oninput="validateInput(this)"></td>
                </tr>
                <tr>
                  <td><label for="sub4">공공편익시설과의 거리 :</label></td>
                  <td><input type="number" id="sub4" name="sub4" min="0" max="100" style="width:50px"
                      oninput="validateInput(this)"></td>
                </tr>
                <tr>
                  <th rowspan="3" class="indicator" style="writing-mode: vertical-lr; text-align: center; ">선택지표</th>
                </tr>
                <tr>
                  <td><label for="sub5">지가수준 :</label></td>
                  <td><input type="number" id="sub5" name="sub5" min="0" max="100" style="width:50px"
                      oninput="validateInput(this)"></td>
                </tr>
                <tr>
                  <td><label for="sub6">도로와의 거리 :</label></td>
                  <td><input type="number" id="sub6" name="sub6" min="0" max="100" style="width:50px"
                      oninput="validateInput(this)"></td>
                </tr>
                <tr >
                    <th colspan="2" class="developscore" style="text-align: center;"><label for="sub7">종합 개발 점수: </label></th>
                    <td><p id="sub7" style="text-align: center; font-size: 14px;"></p></td>
                </tr>
                <tr>
                  <td colspan="4" style="text-align: center;">
                    <button type="button" class="developbutton" onclick="insertDevelop()">입력</button>
                    <button type="button" class="developbutton" onclick="updateDevelop()">수정</button>
                    <button type="button" class="developbutton" onclick="deleteDevelop()">삭제</button>
                    <!-- 개발적성 ID 입력 요소 -->
                    <input type="hidden" id="developId">
                  </td>
                </tr>
              </table>
              <table border="1" class="mainintegrity" style="width: 100%;">
                <tr>
                  <th colspan="3" class="integrity">보전적성 <button type="submit" class="integritybutton">종합점수</button></th>
                </tr>
                <tr>
                  <th rowspan="5" class="indicator" style="writing-mode: vertical-lr; text-align: center; ">필수지표</th>
                </tr>
                <tr>
                  <td><label for="sub8">경지정리면적 비율 :</label></td>
                  <td><input type="number" id="sub8" name="sub8" min="0" max="100" style="width:50px"
                      oninput="validateInput(this)"></td>
                </tr>
                <tr>
                  <td><label for="sub9">생태·자연도상위등급 비율 :</label></td>
                  <td><input type="number" id="sub9" name="sub9" min="0" max="100" style="width:50px"
                      oninput="validateInput(this)"></td>
                </tr>
                <tr>
                  <td><label for="sub10">공적규제지역면적 비율 :</label></td>
                  <td><input type="number" id="sub10" name="sub10" min="0" max="100" style="width:50px"
                      oninput="validateInput(this)"></td>
                </tr>
                <tr>
                  <td><label for="sub11">공적규제지역과의 거리 :</label></td>
                  <td><input type="number" id="sub11" name="sub11" min="0" max="100" style="width:50px"
                      oninput="validateInput(this)"></td>
                </tr>
                <tr>
                  <th rowspan="3" class="indicator" style="writing-mode: vertical-lr; text-align: center; ">선택지표</th>
                </tr>
                <tr>
                  <td><label for="sub12">농업진흥지역 비율 :</label></td>
                  <td><input type="number" id="sub12" name="sub12" min="0" max="100" style="width:50px"
                      oninput="validateInput(this)"></td>
                </tr>
                <tr>
                  <td><label for="sub13">하천·호소·농업용저수지와의 <br>거리:</label></td>
                  <td><input type="number" id="sub13" name="sub13" min="0" max="100" style="width:50px"
                      oninput="validateInput(this)"></td>
                </tr>
                <tr >
                    <th colspan="2" class="integrityscore"><label for="sub14" style="text-align: center;">종합 보전 점수: </label></th>
                    <td><p id="sub14" style="text-align: center; font-size: 14px;"></p></td>
                </tr>
                <tr>
                  <td colspan="4" style="text-align: center;">
                    <button type="button" class="integritybutton" onclick="insertIntegrity()">입력</button>
                    <button type="button" class="integritybutton" onclick="updateIntegrity()">수정</button>
                    <button type="button" class="integritybutton" onclick="deleteIntegrity()">삭제</button>
                    <!-- 보전적성 ID 입력 요소 -->
                    <input type="hidden" id="integrityId">
                  </td>
                </tr>
              </table>
              <table class="maintotal" style="width: 100%;">
                <tr>
                  <th class="total">종합 적성 값: </th>
                  <td><p id="sub15" style="text-align: center; font-size: 14px;"></p></td>  
                </tr>
              </table>

              <!-- 입력한 값이 0 ~ 100 사이의 값이 아닐 경우 알림 창이 뜨게함-->
              <script>
                function validateInput(input) {
                  const value = input.value;
                  if (value === '') {
                    return;
                  }
                  const numericValue = Number(value);
                  if (isNaN(numericValue) || numericValue < input.min || numericValue > input.max) {
                    input.value = '';
                    alert('0 ~ 100 사이의 값으로 입력해주세요');
                  }
                }
              </script>
            </form>
          </div>
      </div>
    </div>

    <!-- mapArea 영역 (맵) -->
    <div id="mapArea">
      <div id="map" class="map">
        <div id="info"></div>
        <!-- 지도 레이어 전환 버튼 -->
        <div id="layerSwitcher">
          <button id="btn-road">일반 지도</button>
          <br>
          <button id="btn-satellite">위성 지도</button>
        </div>
      </div>
    </div>
  </div> <!-- container 닫기 -->

  <!-- 거리 및 면적계산 버튼 -->
  <select id="type">
    <option value="LineString">Length (LineString)</option>
    <option value="Polygon">Area (Polygon)</option>
  </select>

  <!-- 거리 및 면적계산 기능 -->
  <div id="area2">
    <form>
      <label for="type">
        <h2>측정 유형 &nbsp;</h2>
      </label>
      <div id="type">
        <button type="button" id="distanceButton">
          <span class="material-symbols-outlined">straighten</span>
        </button>
        <button type="button" id="areaButton">
          <span class="material-symbols-outlined">pageless</span>
        </button>
        <br>
        <br>
      </div>
      <div id="choice">
        <label for="segments">- 측정 길이 표시:&nbsp;</label>
        <input type="checkbox" id="segments" checked /> &nbsp;
        <label for="clear">- 이전 측정값 삭제:&nbsp;</label>
        <input type="checkbox" id="clear" checked />
      </div>
    </form>
    <!--폴리곤 생성-->
    <div class="polygonbuttons">
      <button id="createPolygonButton">폴리곤 생성</button>
      <button id="saveButton">폴리곤 저장</button>
      <button id="removeButton">폴리곤 삭제</button>
    </div>
  </div>

  <!-- 동적검색을 위한 script -->
  <script>
    let searchIcon = document.querySelector(".search");
    let clearIcon = document.querySelector(".clear");
    let searchInput = document.getElementById("search");
    let searchResults = document.getElementById("search-results");

    searchIcon.onclick = function () {
      document.querySelector(".container1").classList.toggle('active');
    }

    clearIcon.onclick = function () {
      searchInput.value = "";
      searchResults.innerHTML = "";
    }

    searchInput.onchange = function () {
      let query = searchInput.value.trim();
      if (query) {
        fetchResults(query);
      } else {
        searchResults.innerHTML = "<p>주소를 입력하세요.</p>";
      }
    }

    // 검색 결과를 토지 정보에 띄우기
    function fetchResults(query) {
      let xhr = new XMLHttpRequest();
      xhr.open("GET", `search.jsp?address=${encodeURIComponent(query)}`, true);
      xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded; charset=UTF-8");
      xhr.onreadystatechange = function () {
        if (xhr.readyState == 4 && xhr.status == 200) {
          let data = xhr.responseText.trim().split('\n'); // 데이터 줄 단위로 나누기
          let filteredData = data.filter(line => line.includes(query));

          if (filteredData.length >= 10) {
            let pnu = data[0];
            let doValue = data[1];
            let cada = data[2];
            let jibun = data[3];
            let jimok = data[4];
            let are = data[5];
            let price = data[6];
            let owner = data[7];
            let owner_re = data[8];
            let owner_da = data[9];

            let html = `
              PNU : <div style="display: inline-block;" id="pnu">${pnu}</div><br>
              소재지 : <div style="display: inline-block;" id="do">${doValue}</div><br>
              대장구분 : <div style="display: inline-block;" id="cada">${cada}</div><br>
              지번 : <div style="display: inline-block;" id="jibun">${jibun}</div><br>
              지목 : <div style="display: inline-block;" id="jimok">${jimok}</div><br>
              면적(㎡) : <div style="display: inline-block;" id="are">${are}</div><br>
              공시지가(원) : <div style="display: inline-block;" id="price">${price}</div><br>
              소유구분 : <div style="display: inline-block;" id="owner">${owner}</div><br>
              소유권변동사유 : <div style="display: inline-block;" id="owner_re">${owner_re}</div><br>
              소유권변동일자 : <div style="display: inline-block;" id="owner_da">${owner_da}</div><br>
              `;

            let insidebar = document.querySelector(".landinfo");
            insidebar.innerHTML = html;
          }
        }
      };
      xhr.send();
    }
    // 하위 목록 보이게 설정
    document.getElementById("ym17").onclick = function () {
      if (document.getElementsByClassName("ymList2")[0].style.display == 'none') {
        document.getElementsByClassName("ymList2")[0].style.display = 'block'
      } else {
        document.getElementsByClassName("ymList2")[0].style.display = 'none';
      }
    }

    // 사이드바(상세정보) 목록 보이게 설정
    document.getElementById("information").onclick = function () {
    const sidebar = document.getElementsByClassName("sidebar")[0];
    const detailInfo = document.getElementById("detailInfo");
    
    if (sidebar.style.display === 'block') {
        sidebar.style.display = 'none';
        detailInfo.classList.remove('active-info');
    } else {
        sidebar.style.display = 'block';
        detailInfo.classList.add('active-info');
    }
  }

  // 사이드바(평가지표) 목록 보이게 설정
  document.getElementById("information1").onclick = function () {
      const area3 = document.getElementsByClassName("area3")[0];
      const detailInfo1 = document.getElementById("detailInfo1");

      if (area3.style.display === 'block') {
        area3.style.display = 'none';
        detailInfo1.classList.remove('active-info1');
      } else {
        area3.style.display = 'block';
        detailInfo1.classList.add('active-info1');
      }
    }

    // 읍면동에 대한 부분 버튼 클릭시 고정
    const buttons = document.querySelectorAll('.ymList span');
    const detailInfo = document.querySelector('.active-info');

    buttons.forEach(option => {
      option.addEventListener('click', () => {
        if (option !== detailInfo) {
          buttons.forEach(btn => btn.classList.remove('active1'));
          option.classList.add('active1');
        }
      });
    });

    //진주시가에 대한 부분 버튼 클릭시 고정
    const buttons1 = document.querySelectorAll('.ymList2 span');

    buttons1.forEach(option => {
      option.addEventListener('click', () => {
        buttons1.forEach(btn => btn.classList.remove('active2'));
        option.classList.add('active2');
      });
    });

  </script>
  <script type="module" src="./main.js"></script>
</body>
</html>